# Container Networks

- 다중 컨테이너 간 통신을 허용하는 것
- 도커 클라이언트(CLI)로 격리된 네트워크를 만들고, 네트워크 이름을 지정하면 됨
- 격리된 네트워크에서 실행되는 모든 컨테이너는 그 안의 다른 컨테이너와 통신할 수 있게 됨
- 호스트는 네트워크를 여러 개 가질 수 있음
- 네트워크를 생성하면 그 네트워크에 속한 컨테이너끼리는 컨테이너 이름으로 통신이 가능
	- 컨테이너를 생성할 때 --hostname 옵션을 사용하면 Hostname으로도 통신 가능
- 컨테이너에 직접 네트워크를 연결하지 않으면 도커에서 기본으로 제공하는 네트워크에 붙음
	- 디폴트 Bridge 네트워크는 네이밍 서비스(이름으로 컨테이너끼리 연결하는 서비스)를 제공하지 않음
		- 이름으로 연결하고 싶으면 컨테이너 생성 시 --link로 alias를 설정해야 함
		- --link를 사용하면 컨테이너의 /etc/hosts(도메인 캐시 파일)에 alias를 기록해줌


> 참고: 컨테이너와 www은 디폴트로 통신 가능함

## 1. 컨테이너 네트워크 생성

```
docker network create --driver driver_name network_name
```

## 2. 컨테이너 네트워크 안에서 컨테이너 실행

```
docker run --net=network_name --name mongodb mongo
```

# 컨테이너에서 Localhost로 접속

> host.docker.internal

- 위에 해당하는 특수 도메인 이름으로 컨테이너 내부에서 호스트 머신에 접속 가능
- 이는 개발용이며 Docker Desktop 외부의 프로덕션 환경에서는 작동하지 않음

# Docker가 IP 주소를 해결하는 방법

- 도커는 소스 코드를 읽지 않고, 컨테이너의 이름만 본 다음 코드에 플러그인된 컨테이너의 IP 주소를 연결
- 도커가 애플리케이션이 실행되는 환경을 소유하고, 애플리케이션이 HTTP 요청이나 DB 요청 또는 컨테이너에서 다른 종류의 요청을 보내는 경우에 도커가 이를 인식
	- 그 시점에 도커는 주소, 컨테이너 이름, host.docker.internal을 실제 IP 주소로 매핑
	- 도커 네트워크를 통해 알 수 있기 때문에 가능
- 즉, 컨테이너에서 요청을 전송할 때만 자동 IP 변환이 발생

# Docker Network Drivers

- Docker Networks는 실제로 네트워크 동작에 영향을 미치는 다양한 종류의 '**드라이버**'를 지원
- 디폴트 드라이버는 '**bridge**' 드라이버
	- 컨테이너가 동일한 네트워크에 있는 경우, <u>이름으로</u> 서로를 찾을 수 있음
- 드라이버는 네트워크 생성 시 '`--driver`' 옵션을 추가하여 설정할 수 있음
	- 'bridge' 드라이버를 사용하고자 하는 경우, 'bridge'가 디폴트이므로, 전체 옵션을 생략하면 됨
- Docker는 아래의 대체 드라이버도 지원하지만 대부분의 경우 'bridge' 드라이버를 사용
	- **host**
		- 스탠드얼론 컨테이너의 경우, 컨테이너와 호스트 시스템 간의 격리가 제거됨 (즉, localhost를 네트워크로 공유)
	- **overlay**
		- 여러 Docker 데몬 (즉, 서로 다른 머신에서 실행되는 Docker)이 서로 연결될 수 있음
		- 여러 컨테이너를 연결하는 구식의 / 거의 사용되지 않는 방법인 'Swarm' 모드에서만 작동
	- **macvlan**
		- 컨테이너에 커스텀 MAC 주소를 설정할 수 있음
		- 그럼 이 주소를 해당 컨테이너와 통신하는데 사용할 수 있음
	- **none**
		- 모든 네트워킹이 비활성화됨
	- **써드파티 플러그인**
		- 모든 종류의 동작과 기능을 추가할 수 있는 타사 플러그인을 설치할 수 있음
- '**bridge**' 드라이버는 대부분의 시나리오에 가장 적합