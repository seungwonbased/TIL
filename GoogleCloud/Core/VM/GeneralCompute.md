# 일반적인 Compute Engine 작업

# 메타데이터

- 모든 VM 인스턴스는 메타데이터 서버에 메타데이터를 저장
- 시작 스크립트 및 종료 스크립트와 함께 메타데이터 서버를 사용하면 특히 유용
    - 메타데이터 서버를 Programmatic 방식으로 사용해 추가 승인 없이 인스턴스에 대한 고유 정보를 얻을 수 있기 때문
    - 예를 들어 인스턴스의 외부 IP 주소에 대한 메타데이터 키-값 쌍을 가져오는 시작 스크립트를 작성하고 스크립트에서 해당 IP 주소를 사용해 데이터베이스를 작성할 수 있음
- 기본 메타데이터 키는 모든 인스턴스에서 동일하므로 스크립트를 재사용할 수 있으며 인스턴스마다 업데이트할 필요가 없음
    - 따라서 애플리케이션용으로 덜 불안정한 코드 작성 가능

# 인스턴스 이동

- 인스턴스를 새로운 영역으로 이동하는 것
- 예를 들어 지리적 이유나 영역에 대한 지원 중단 때문에 이동이 필요할 수 있음
- 다음 두 가지 경우 중 하나만 해당돼도 VM을 이동할 수 있음
    - VM 인스턴스가 종료 상태인 경우
    - VM 인스턴스가 UEFI 펌웨어를 사용하는 보안 VM인 경우
- 동일한 리전 내에서 인스턴스를 이동하는 경우 gcloud compute instances move 명령어를 통해 이동을 자동화할 수 있음
- VM이 이동하려면 VM을 종료하고 VM을 대상 영역이나 리전으로 이동한 후 다시 시작해야 함
- VM을 이동한 후에는 원본 리소스에 대한 기존 참조를 업데이트해야 함
    - 예를 들어 기존 VM을 가리키는 대상 VM이나 대상 풀
- 이동하는 동안 서버에서 생성되는 VM과 디스크의 일부 속성이 변경됨
- 다른 리전으로 인스턴스를 이동하는 경우에는 여기 설명한 대로 수동으로 이동해야 함
    - 여기에는 모든 영구 디스크의 스냅샷을 만들고 대상 영역에 스냅샷에서 가셔온 새 디스크를 만드는 과정 포함
    - 그런 다음 대상 영역에 새 VM을 만들고 새 영구 디스크를 연결한 후 고정 IP를 할당하고 VM에 관한 참조를 업데이트함
    - 마지막으로 원본 VM, 디스크, 스냅샷을 삭제

## 스냅샷

- 중요한 데이터를 내구성 있는 스토리지 솔루션에 백업해 애플리케이션, 가용성, 복구 요건 충족 가능
- 스냅샷은 Cloud Storage에 저장됨
- 영역 간에 데이터를 마이그레이션 할 수도 있음
    - 예를 들어 지연 시간을 최소화하고 싶다면 데이터 사용 영역에서 로컬 연결이 가능한 드라이브로 데이터를 마이그레이션
- 다른 디스크 유형으로 데이터를 마이그레이션 할 수도 있음
    - 예를 들어 디스크 성능 향상을 위해 HDD 영구 디스크에서 SSD 영구 디스크로 데이터 이전

### (영구) 디스크 스냅샷

- 스냅샷은 로컬 SSD가 아니라 영구 디스크에서만 사용할 수 있음
- 스냅샷은 주로 인스턴스를 만들거나 인스턴스 템플릿을 구성하는 데 사용되는 공개 이미지나 커스텀 이미지와는 다름
- 스냅샷은 영구 디스크에 있는 데이터의 주기적 백업에 유용
- 스냅샷은 자동으로 압축되므로 디스크의 전체 이미지를 정기적으로 만들 때와 비교해 더 빠르고 훨씬 저렴한 비용으로 영구 디스크에 정기적인 스냅샷을 만들 수 있음

# 영구 디스크의 크기 조정

- 스토리지 용량을 늘리면 I/O 성능이 향상된다는 추가적인 이점이 있음
- 실행 중인 VM에 디스크가 연결된 상태에서 스토리지 용량을 늘릴 수 있으며 스냅샷을 만들 필요가 없음
- 다만 디스크 크기는 늘리는 것만 가능 (줄이는 것은 안 됨)