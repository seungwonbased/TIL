# IP address

# IP 주소

- Google Cloud에서 가상 머신마다 두 개의 IP 주소 할당 가능

## 내부 IP 주소

- DHCP를 통해 내부적으로 할당
- 시작되는 모든 VM과 가상 머신에 종속된 모든 서비스에 내부 IP 주소가 제공됨
    - App Engine, Google Kubernetes Engine 등
- Google Cloud에서 VM을 만들 때 기호화된 이름이 내부 DNS로 등록되며 여기에서 이 이름을 내부 IP 주소로 변환
- DNS는 네트워크로 범위가 지정되므로 동일한 네트워크에 있는 호스트의 웹 URL과 VM 이름은 변환 가능하지만 다른 네트워크에 있는 VM 호스트 이름은 변환할 수 없음

## 외부 IP 주소

- 선택 사항임
- 기기 또는 머신이 외부와 통신하는 경우 할당 가능
- 해당 외부 IP 주소는 풀에서 할당하면 임시 주소가 되고 지정된 외부 IP 주소를 할당하면 정적 주소가 됨
- 정적 외부 IP 주소를 지정하고 VM 인스턴스 또는 전달 규칙 등의 리소스에 할당하지 않으면 사용 중인 정적 IP 주소와 임시 외부 IP 주소보다 높은 요금이 청구됨
- 공개적으로 라우팅 가능한 자체 IP 주소 프리픽스를 Google Cloud 외부 IP 주소로 사용하여 인터넷에 이를 공지할 수 있음
    - 그러기 위해서는 /24 블록 이상을 소유해야 함

# IP 주소 매핑

- 임시 또는 정적 IP 주소의 사용 여부와 관계 없이 VM의 OS에서는 외부 주소를 알 수 없음
- 외부 IP 주소는 VPC에 의해 투명하게 VM의 내부 주소에 매핑됨

## 내부 IP 주소 DNS 변환

- 각 인스턴스에는 내부 IP 주소로 변환될 수 있는 호스트 이름이 있음
    - 호스트 이름은 인스턴스 이름과 같음
- 인스턴스에는 내부 정규화된 도메인 이름(FQDN)이 있음
    - [hostname].[zone].c.[project-id].internal
- 인스턴스를 삭제하고 다시 만들면 내부 IP 주소가 변경될 수 있음
    - 다른 Compute Engine 리소스의 연결이 이로 인해 중단될 수 있으며 이러한 리소스가 다시 연결하기 위해서는 새로운 IP 주소를 얻어야 함
- 내부 IP 주소가 무엇이든 DNS 이름은 항상 특정 인스턴스를 가리킴
- 각 인스턴스에는 메타데이터 서버가 있고 이는 해당 인스턴스의 DNS 리졸버로도 작동
    - 메타데이터 서버는 로컬 네트워크 리소스에 대한 모든 DNS 쿼리를 처리하고 다른 모든 쿼리들은 Google의 공개 DNS 서버로 라우팅해 공개 이름을 변환
    - 인스턴스는 인스턴스에 할당된 외부 IP 주소를 인식하지 못함
        - 대신 외부 IP 주소와 일치하는 조회 테이블을 만들어 관련 인스턴스의 내부 IP 주소와 함께 저장

## 외부 IP 주소 DNS 변환

- 외부 IP 주소가 있는 인스턴스는 프로젝트 외부 호스트로부터의 연결을 허용할 수 있음
    - 사용자는 외부 IP 주소를 사용해 직접 연결 가능
- 인스턴스를 가리키는 공개 DNS 레코드는 자동으로 게시되지 않지만 관리자는 기존 DNS 서버를 사용해 이를 게시 가능
- DNS는 Cloud DNS를 사용해 Google Cloud에서 호스팅 가능

## Cloud DNS

- Cloud DNS는 확장성과 안정성이 높은 관리형 권한 도메인 이름 시스템(DNS) 서비스로 Google과 동일한 인프라에서 실행
- google.com과 같은 도메인 이름 요청을 IP 주소로 변환
- Google의 글로벌 Anycast 네임서버 네트워크를 통해 DNS 영역을 전 세계의 중복 위치에서 지원하므로 사용자에게 높은 가용성과 짧은 지연 시간을 제공
- 고가용성
    - Google Cloud는 100% 업타임을 보장하는 SLA를 Cloud DNS에 구성된 도메인에 대해 제공
- Cloud DNS를 사용하면 수백만 개의 DNS 레코드를 자체 DNS 서비스 및 소프트웨어 관리의 부담 없이 생성, 업데이트 가능
    - 간단한 사용자 인터페이스, 명령줄 인터페이스나 API를 사용
- 별칭 IP 범위 기능 제공
    - 내부 IP 주소의 범위를 VM의 네트워크 인터페이스에 별칭으로 할당 가능
    - 이는 하나의 VM에서 여러 서비스를 실행하고 있어 각 서비스에 서로 다른 IP 주소를 할당하고자 할 때 유용
    - 여러 IP 주소를 구성하여 VM에서 호스팅되는 컨테이너 또는 애플리케이션을 나타낼 수 있고 이때 별도의 네트워크 인터페이스를 정의할 필요가 없음