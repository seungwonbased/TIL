# Project, networks, subnetworks

# Project and networks

## Project

- Google Cloud에서 인프라 리소스를 정리하는 핵심 요소
- 프로젝트는 객체 및 서비스를 결제와 연결
- 실제로 프로젝트에는 전체 네트워크가 포함됨

## Networks

- 각 프로젝트의 기본 할당량은 네트워크 5개
    - Cloud Console을 사용해 추가 할당량 요청 가능
    - 이러한 네트워크는 다른 프로젝트와 공유하거나 다른 프로젝트의 네트워크와 피어링 가능
    - 이 네트워크에는 IP 범위가 없으며 네트워크 내 모든 개별 IP 주소와 서비스로 이뤄진 구성체
- Google Cloud의 네트워크는 전역 네트워크로 사용 가능한 리전이 전세계에 분포
    - 네트워크 하나만 있으면 전세계에 분포
- 네트워크 내에서는 리소스를 리전별 서브네트워크로 분리 가능

### 유형

- `Default`
    - 프로젝트에는 서브넷 및 방화벽 규칙이 사전 설정된 기본 VPC 네트워크가 제공됨
    - 서브넷은 각 리전에 할당되고 겹치지 않는 CIDR 블록과 방화벽 규칙이 제공되어 어디에서나 ICMP, RDP, SSH 트래픽에 대해 인그레스 트래픽을 허용하며 모든 프로토콜 및 포트의 기본 네트워크 내 인그레스 트래픽도 허용
- `Auto Mode`
    - 각 리전에 하나의 서브넷이 자동으로 생성됨
    - 기본 네트워크가 자동 모드 네트워크임
    - 자동으로 생성된 서브넷은 사전 정의된 IP 범위 집합을 사용하며 /16 마스크로 확장할 수 있는 /20 마스크를 사용
    - 모든 서브넷은 10.128.0.0/9 CIDR 블록에 속함
- `Custom Mode`
    - 서브넷을 자동으로 만들지 않음
    - 개발자가 서브넷과 IP 범위를 완전히 제어 가능
        - 자신이 선택한 리전에 어떤 서브넷을 만들지 결정하고 직접 지정한 IP 범위를 사용
    - 커스텀 모드를 자동 모드로 변경 불가능

![core](https://github.com/seungwonbased/TIL/blob/main/GoogleCloud/assets/corepr1.png)

- A와 B는 다른 리전에 있지만 동일한 네트워크에 있으므로 내부 IP 주소를 사용해 통신 가능
- C와 D는 동일한 네트워크에 있지 않아 인터넷을 통해 외부 IP로 통신해야 함
    - 이는 결제와 보안에 영향을 끼침

![core](https://github.com/seungwonbased/TIL/blob/main/GoogleCloud/assets/corepr2.png)

- VPC 내 VM 인스턴스는 글로벌 규모로 비공개 통신 가능하므로 단일 VPN으로 안전하게 Google Cloud 네트워크에 온프레미스 네트워크를 연결할 수 있음
    - 비용 절감 및 관리 수월

![core](https://github.com/seungwonbased/TIL/blob/main/GoogleCloud/assets/corepr3.png)

- 서브넷은 리전 규모로 작동
- 리전에는 여러 존이 포함되므로 서브넷은 존을 교차할 수 있음
- 서브넷은 단순히 IP 주소 범위이며 해당 범위 내에서 IP 주소를 사용 가능
- 지정된 주소
    - 범위의 첫번째, 두번째 주소인 .0, .1은 각각 네트워크용, 서브넷 게이트웨이용
    - 범위의 끝에서 두번째, 마지막 주소는 브로드캐스트 주소
- 두 가상 머신이 다른 영역에 있어도 같은 서브넷 IP 주소를 사용해 서로 통신해 단일 방화벽 규칙 적용 가능

![core](https://github.com/seungwonbased/TIL/blob/main/GoogleCloud/assets/corepr4.png)

- Google Cloud VPC를 사용하면 워크로드 중단이나 다운타임 없이 서브넷의 IP 주소 공간을 늘릴 수 있음
- 필요에 맞게 유연하게 사용하고 확장할 수 있지만 주의사항이 몇 가지 있음
    - 새 서브넷 마스크는 동일한 VPC 네트워크의 다른 서브넷과 겹치면 안되며 이는 리전과 무관
    - VPC 네트워크 내 모든 서브넷의 IP 범위는 각각 고유한 유효 CIDR 블록이어야 함
    - 새 서브넷 IP 범위가 리전 내부 IP 주소이며 유효한 IP 범위 내에 있어야 함
    - 서브넷 범위는 유효한 RFC 범위와 비공개로 사용되는 공개 IP 주소 범위에 걸쳐 있을 수 없음
        - 확장을 실행 취소 할 수 없음
    - 자동 모드 서브넷을 커스텀 모드 서브넷으로 전환해 IP 범위를 늘릴 수 있음
    - 서브넷을 크게 만들지 말 것
        - 지나치게 큰 서브넷은 CIDR 범위 충돌을 일으킬 가능성이 높음
        - 다중 네트워크 인터페이스 및 VPC 네트워크 피어링을 사용하거나 온프레미스 네트워크에 VPN이나 기타 연결을 구성할 때 충돌 위험이 있음