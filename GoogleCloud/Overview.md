# 구글 클라우드 개요

![overview](https://github.com/seungwonbased/TIL/blob/main/GoogleCloud/assets/overview.png)

# VM

- `Zone`: VM이 생성되는 장소, 지역에 실제로 위치한 데이터 센터
- `Region`: 대륙

## 생성 조건

- 이름
- Zone
- 머신 유형
- 부팅 디스크
- 액세스 범위
- 방화벽
- 내부 IP, 외부 IP
- 시작 스크립트

# 로드 밸런서

- 일반적인 L4 스위치와 같이 TCP/UDP 프로토콜을 라우팅
- HTTP 프로토콜에 대해서는 HTTPS Termination과 URI에 따라서 가까운 서버나 특정 서버로 라우팅하는 L7과 유사한 기능을 제공
- 서버로 들어오는 트래픽을 (인터넷이 아니라) 구글이 전세계에 배포한 에지노드 중 가장 가까운 노드에 접속한 후, 구글의 광케이블 백본망으로 목표 서버로 전송, 이 기능은 네트워크 구간의 속도를 획기적으로 줄여줌
- 프리웜업(pre-warm up)이 필요 없음
- 지역 수준의 부하 분산이 가능
- 모든 트래픽 로깅 가능

## 관리 그룹과 비관리 그룹

- `관리 그룹`: 템플릿을 만들어 인스턴스 생성을 클라우드가 담당하게 한다. 인스턴스는 사용자가 직접 추가할 수 없다. 템플릿이란 인스턴스를 만들기 위한 틀과 같은 것이다. VM의 크기, OS 이미지 등의 설정을 미리 해놓으면 클라우드가 인스턴스를 생성할 때 해당 템플릿이 정의한 설정에 따라 인스턴스를 추가하게 된다.
- `비관리 그룹`: 인스턴스를 수동으로 묶어 놓은 그룹이다. 인스턴스의 크기나 종류에 상관 없이 그냥 묶어
만 놓은 것이다. 수동으로 아무 종류의 인스턴스나 추가해넣을 수 있기 때문에 오토 스케일링은 불가능하다.

# 오토 스케일링

- `인스턴스 템플릿`: 인스턴스를 생성할 때의 설정값(디스크 이미지, 인스턴스 크기, 네트워크 설정)을 미리 정해놓고, 템플릿에 정의한 대로 인스턴스를 생성하 게 해주는 설정값의 모음
    1. 인스턴스 생성 및 초기 소프트웨어 설치
    2. 스냅샷 생성
    3. 스냅샷 디스크 생성
        - 디스크는 데이터를 저장하는 데 사용되는 물리적인 하드웨어 장치
    4. 디스크 이미지 생성
        - 디스크 이미지는 디스크에 저장된 모든 데이터와 구성 요소를 포함하는 정적 파일
    5. 템플릿 생성

## 오토 스케일링 조건

- CPU 사용량
- HTTP 부하 분산 (로드 밸런서 사용량)
- 측정 항목 모니터링
- 위의 3가지를 조합할 수도 있음

# 서브넷

- `Subnet`: 하나의 공인(외부) IP를 논리적으로 분할해 여러 개의 사설(내부) IP로 사용할 수 있게 해주는 방법
    - 한정적인 공인 IP를 효율적으로 관리하고 사용하도록 해줌
    - 트래픽을 분산하여 통신 속도를 높임
    - 네트워크를 독립적인 여러 네트워크로 분할하여 보안 측면에서도 유리
- `NAT Gateway`: 통신망에서 사설 IP를 공인 IP로 변환해주는 변환기
    - 다수의 사설 IP를 공인 IP로 변환하여 한정된 자원인 공인 IP를 절약하기 위해 사용
    - 사설 IP를 외부에 노출하지 않고 방화벽을 설치하여 외부 공격으로부터 사용자의 통신망을 보호

# 방화벽

- 구글 클라우드로 들어오는 Inbound 트래픽은 기본적으로 막혀 있으며 이를 허용하는 규칙만 생성 가능
- 기본 네트워크에서는 TCP 22번 포트 (SSH), 3389번 포트 (RDP), ICMP, 내부(VM간의 통신)를 제외하고 모두 막혀 있음
- 반면, 직접 서브넷이나 레거시로 구성하는 경우에는 특별한 방화벽 규칙이 없음
- CIDR 표기법과 VM 인스턴스 태그를 사용한 범위로 트래픽 제한 가능

# IAM (Identity and Access Management)

- 구글 클라우드의 서비스들로의 액세스를 편리하고 일관된 방식으로 제어할 수 있음

## 구성원 유형

- Google 계정: 명시한 특정 사용자에게 권한 부여
- Google 그룹스: 해당 그룹의 구성원 모두에게 권한을 부여
- 서비스 계정: 개별 사용자 대신 구글 클라우드에서 호스팅되는 사용자 애플리케이션에 부여하는 ID, 하나의 애플리케이션이라도 기능별로 서로 다른 서비스 계정을 부여할 수 있음
- Google Apps 도메인: 해당 도메인의 구성원 모두에게 권한 부여
- 모든 구성원: ‘allUsers’를 입력하면 모든 사용자에게 액세스 권한 부여
- 모든 Google 계정: ‘allAuthenticatedUsers’를 입력하면 Google 계정으로 로그인한 모든 사용자에게 액세스 권한 부여

## 사용자 역할

### 기본 역할

- Viewer: 구글 클라우드 리소스를 보기만 할 수 있음
- Editor: 뷰어 권한에 자원을 생성/삭제/변경할 수 있는 권한 추가
- Owner: 편집자 권한에 프로젝트 자체와 그 구성원을 관리하는 권한 추가, 프로젝트를 처음 만든 계정에는 이 권한이 자동으로 부여됨

### 기본 역할 외

- Service account actor: 서비스별로 세분화한 역할을 지정하여 사용 시에 서비스 계정의 정보를 획득하고 인증 시에 사용하여 보안성을 높임
- Billing administrator: 결제 관련 사항 관리