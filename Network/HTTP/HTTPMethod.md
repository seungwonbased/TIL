# HTTP method

# HTTP 메서드

> “가장 중요한 것은 리소스 식별”

## API URI 고민

- 리소스의 의미란?
	- 예: 미네랄을 캐라 → 미네랄이 리소스, 회원을 등록해라 → 회원이 리소스
- 리소스를 어떻게 식별?
	- 회원을 등록하고 수정하고 조회하는 것을 모두 배제
	- 회원이라는 리소스만 식별하면 됨 → 회원 리소스를 URI에 매핑
- URI는 리소스만 식별, 리소스와 행위를 분리
- 행위는 메서드로 구분
- 예:
    ![hm](https://github.com/seungwonbased/TIL/blob/main/Network/assets/hm1.png)
	- POST 기반 등록 API 설계 예시
	- 계층 구조상 상위를 컬렉션으로 보고 복수 단어 사용 권장 (member → members)

## HTTP 메서드 종류

- GET: 리소스 조회
- POST: 요청 데이터 처리, 주로 등록에 사용
- PUT: 리소스를 대체, 없으면 생성
- PATCH: 리소스 부분 변경
- DELETE: 리소스 삭제

### GET

- 리소스 조회
- 서버에 전달하고 싶은 데이터는 Query(쿼리 파라미터, 쿼리 스트링)을 통해서 전달
- 메시지 바디를 사용해서 데이터를 전달할 수는 있지만, 지원하지 않는 곳이 많아서 권장하지 않음

### POST

- 새 리소스 생성
- 요청 데이터 처리
	- 단순히 데이터를 생성하거나, 변경하는 것을 넘어서 프로세스를 처리해야 하는 경우
	- 예: 주문에서 “결제 완료 → 배달 시작 → 배달 완료”처럼 프로세스 상태가 변경되는 경우
- 메시지 바디를 통해서 서버로 요청 데이터 전달
- 서버는 요청 데이터를 처리
	- 메시지 바디를 통해 들어온 데이터를 처리하는 모든 기능을 수행
- 주로 전달된 데이터로 신규 리소스 등록, 프로세스 처리에 사용
- 요청 데이터를 어떻게 처리한다는 뜻일까?
    
    <aside>
    💡 Spec: POST 메서드는 대상 리소스가 고유한 의미 체계에 따라 요청에 포함된 표현을 정리하도록 요청한다.
    
    </aside>
    
	- HTML 양식에 입력된 필드와 같은 데이터 블록을 데이터 처리 프로세스에 제공
		- HTML FORM에 입력한 정보로 회원 가입, 주문 등
	- 게시판, 뉴스 그룹, 메일링 리스트, 블로그 또는 유사한 기사 그룹에 메시지 게시
		- 게시판 글쓰기, 댓글 달기 등
	- 서버가 아직 식별하지 않은 것
		- 신규 주문 생성 등
	- 기존 자원에 데이터 추가
		- 한 문서 끝에 내용 추가
- 이 리소스 URI에 POST 요청이 오면 요청 데이터를 어떻게 처리할지 리소스마다 따로 정해야 함
	- 정해진 것이 없음

### PUT

- 리소스를 대체
	- 리소스가 있으면 대체
	- 리소스가 없으면 생성
	- 덮어쓰기를 생각하면 될듯
- **중요! 클라이언트가 리소스를 식별**
	- 클라이언트가 리소스 위치를 알고 URI 지정
	- POST와 차이점, 클라이언트가 특정 리소스를 식별하는 id값 같은 것을 넣어줘야 함

### PATCH

- 리소스 부분 변경

### DELETE

- 리소스 제거

## HTTP 메서드 속성

![hm](https://github.com/seungwonbased/TIL/blob/main/Network/assets/hm2.png)

- 안전
	- 호출해도 리소스를 변경하지 않음
- 멱등
	- $f(f(x)) = f(x)$
	- 한 번 호출하든 두 번 호출하든 100번 호출하든 결과가 똑같음
	- 멱등 메서드
		- GET: 몇 번을 조회해도 같은 결과가 조회됨
		- PUT: 같은 것을 덮어씌움
		- DELETE: 결과를 삭제함
		- **POST: 멱등이 아님!!! 두 번 호출하면 같은 결제가 중복해서 발생할 수 있음**
	- 활용
		- 자동 복구 매커니즘
		- 서버가 TIMEOUT 등으로 정상 응답을 못 주었을 때, 클라이언트가 같은 요청을 다시 해도 되는가에 대한 판단 근거
- 캐시 가능
	- 응답 결과 리소스를 캐시해서 사용해도 되는가?
		- GET, HEAD, POST, PATCH 캐시 가능
		- 실제로는 GET, HEAD 정도만 캐시로 사용

## HTTP API (REST API) 설계 예시

- **회원 관리 시스템: POST 기반 신규 자원 등록**
	![hm](https://github.com/seungwonbased/TIL/blob/main/Network/assets/hm3.png)
	- 특징
		- 클라이언트는 등록될 리소스의 URI를 모름
		- POST /members
	- 서버가 새로 등록된 리소스 URI를 생성
	- Collection
		- 서버가 관리하는 리소스 디렉토리
		- 서버가 리소스의 URI를 생성하고 관리
		- 여기서 컬렉션은 /members
- **파일 관리 시스템: PUT 기반 신규 자원 등록**
	![hm](https://github.com/seungwonbased/TIL/blob/main/Network/assets/hm4.png)
	- 특징
		- 클라이언트가 리소스 URI를 알고 있어야 함
		- PUT /files/star.jpg
	- 클라이언트가 직접 리소스의 URI 지정
	- Store
		- 클라이언트가 관리하는 리소스 저장소
		- 클라이언트가 리소스의 URI를 알고 관리
		- 여기서 스토어는 /files
- **HTML form 사용**
	![hm](https://github.com/seungwonbased/TIL/blob/main/Network/assets/hm5.png)
	- 특징
		- GET, POST만 지원
		- 컨트롤 URI
			- GET, POST만 지원하므로 제약이 있음
			- 이런 제약을 해결하기 위해 동사로 된 리소스 경로 사용
			- POST의 /new, /edit, /delete가 컨트롤 URI
			- HTTP 메서드로 해결하기 애매한 경우 사용