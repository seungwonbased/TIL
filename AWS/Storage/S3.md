- 많은 웹은 Amazon S3에 의존
- 예를 들어, 많은 웹사이트에서는 Amazon S3를 중추로 활용하며, 많은 AWS 서비스는 또한 Amazon S3를 통합을 위해 사용하고 있음
- 본질적으로 S3는 스토리지

## Amazon S3 Use Cases 

- Amazon S3는 백업과 스토리지로 활용됨
	- 파일용일 수도 있고 디스크용일 수도 있음
- 재해 복구의 용도로도 쓰임
	- 예를 들어 리전이 다운되는 경우 여러분은 데이터를 다른 리전으로 이동시킴
	- 그러면 해당 데이터는 어딘가에 백업됨
- 아카이브용으로도 사용
	- Amazon S3에 파일을 아카이브해 두면 추후 매우 손쉽게 검색할 수 있음
- 다음 용도는 하이브리드 클라우드 스토리
	- 온프레미스에 스토리지가 있지만 클라우드로 확장하고자 한다면 Amazon S3를 사용할 수 있음
- 애플리케이션을 호스팅하고 동영상 파일이나 이미지 등 미디어를 호스팅할 수 있음
- 데이터 레이크를 보유하여 다량의 데이터를 저장하고 빅 데이터 분석을 수행하기 위해서도 사용됨
- 정적 웹 사이트를 호스팅하기 위해서 등 다양한 용도로 쓰임
- 2가지 사용 사례
	- Nasdaq은 7년간의 데이터를 S3 Glacier에 저장해 둠
		- 이는 Aamzon S3의 아카이브 서비스와 유사
	- Sysco는 자체 데이터에 관한 분석을 실행하여 Amazon S3로부터 비즈니스 인사이트를 얻음

## Amazon S3 Buckets

- Amazon S3는 파일을 버킷에 저장하는데, 버킷은 상위 레벨 디렉토리로 표시됨
- S3 버킷의 파일은 객체라고 하며 이 버킷은 계정 안에 생성됨
- 버킷에는 전역적으로 고유한 이름이 있어야 함
	- 즉, 이름은 계정에 있는 모든 리전과 AWS에 존재하는 모든 계정에서 고유해야 함
	- AWS에서 전역적으로 고유한 단 하나의 이름
- 버킷은 리전 수준에서 정의됨
	- 버킷 이름이 모든 리전과 모든 계정에서 고유해도 버킷은 반드시 특정 AWS 리전에서 정의되어야 함
	- S3는 전역 서비스처럼 보이지만 버킷은 사실상 리전에서 생성됨
- S3 버킷에는 명명 규칙이 있음
	- 버킷 이름에는 대문자나 밑줄이 없어야 함
	- 길이는 3자에서 63자 사이여야 하며 IP여서는 안 되고 소문자나 숫자로 시작해야 함
	- 몇 가지 접두사 제한도 있음
	- 문자와 숫자, 하이픈만 사용하면 됨

## Amazon S3 Objects
### Key

- 객체나 파일에는 키라는 것이 있는데, Amazon S3 키는 파일의 전체 경로
- 예시
	- my_file.txt의 키: my_folder1/another_folder/my_file.txt
	- 이렇게 키는 접두사와 객체 이름으로 구성
	- 이전의 경로를 my_folder1와 another_folder라는 접두사, 그리고 my_file.txt라는 객체 이름으로 분해 가능
- Amazon S3 그 자체로는 디렉토리의 개념은 없고, 핵심은 키
### Object

- 객체값은 본문의 내용
- 파일 등 원하는 것은 뭐든지 Amazon S3로 업로드할 수 있음
- 최대 객체 크기는 5TB
- 한 번의 업로드 작업은 5GB를 초과할 수 없음
- 파일이 5GB보다 크다면 멀티파트 업로드를 사용해서 해당 파일을 여러 부분으로 나눠 업로드해야 함
	- 따라서 5TB의 파일을 가지고 있다면 최소 1000개 부분으로 나눠서 업로드해야 함
- Metadata
	- 객체의 키-값 쌍 리스트
	- 시스템이나 사용자에 의해 설정되어 파일에 관한 요소나 메타데이터를 나타낼 수 있음
- Tags
	- 태그의 경우 가령 유니코드 키-값 쌍은 최대 10개까지 가능
	- 태그는 보안과 수명 주기에 유용
- Version ID (If versioning is enabled)
	- 때때로 객체는 버전 ID를 갖기도 함
	- 버전 관리를 활성화한 경우

## Amazon S3 - Security

-  User-Based Security
	- 사용자에게는 IAM 정책이 주어지는데, 이 정책은 어떤 API 호출이 특정 IAM 사용자를 위해 허용되어야 하는지를 승인함
- Resource-Based Security
	- 새로운 보안 기능
	- S3 버킷 정책
		- S3 버킷의 보안을 관리하는 가장 일반적인 방법
		- 이 정책은 S3 콘솔에서 직접 할당할 수 있는 전체 버킷 규칙
		- 예를 들어, 특정 사용자가 들어올 수 있게 하거나 다른 계정의 사용자를 허용할 수 있음
			- 이를 S3 버킷에 액세스할 수 있는 교차 계정이라고 함
		- 이는 S3 버킷을 공개로 만드는 방법이기도 함
	- Object Access Control List (ACL) 
		- 이 목록은 보다 세밀한 보안이며 비활성화할 수 있음
	- Bucket Access Control List
		- 버킷 수준의 버킷 ACL이 있는데, 훨씬 덜 일반적임
		- 이 역시 비활성화 가능
- Encryption
	- Amazon S3 보안을 관리할 수 있는 또 다른 방법은 암호 키를 사용하여 객체를 암호화하는 것
	- 
- IAM 원칙이 S3 객체에 액세스할 수 있는 상황
	- IAM 권한이 이를 허용하거나 리소스 정책이 이를 허용하는 경우
		- IAM 원칙이 특정 API 호출 시 S3 객체에 액세스할 수 있음

### Amazon S3 Bucket Policies

![as1](https://github.com/seungwonbased/TIL/blob/main/AWS/assets/as1.png)

- S3 보안의 주안점은 버킷 정책
- JSON 기반의 정책
	- Resource
		- 리소스는 이 정책이 적용되는 버킷과 객체를 정책에 알려줌
		- 위 예시에서는 examplebucket 내에서 모든 객체에 적용되는 것을 볼 수 있음
			- 별표가 쓰인 이유
	- Effect
		- 허용 아니면 거부
		- Action을 허용하거나 거부하는 것
	- Action
		- 허용하거나 거부할 수 있는 API 집합
		- 예시에서 허용한 작업은 GetObject
	- Principle
		- 원칙은 정책을 적용할 계정 또는 사용자를 제시
		- 예시에서 원칙은 별표로 표시되었는데 이 경우 별표를 통해 모든 사용자를 허용할 수 있음
			- 따라서 이 S3 버킷은 버킷 내 모든 객체에 대해 공개 읽기로 설정하고 있음
- 필요한 버킷 정책을 사용해서 버킷에 대한 공개 액세스를 허용할 수 있으며  업로드 시 객체를 강제로 암호화하거나 또 다른 계정으로의 액세스를 허용할 수도 있음

#### Example: Public Access - Use Bucket Policy

![as2](https://github.com/seungwonbased/TIL/blob/main/AWS/assets/as2.png)

- 공개 액세스를 위한 버킷 정책이 있다고 가정
- 사용자는 월드 와이드 웹에 있는데, 이 웹사이트 방문자는 S3 버킷 안에 있는 파일에 액세스하려고 함
- 필요한 버킷 정책을 첨부해서 공개 액세스를 허용할 것임
- 버킷 정책이 S3 버킷에 첨부되면 그 안에 있는 모든 객체에 액세스할 수 있음

#### Example: User Access to S3 - Use IAM Policy

![as3](https://github.com/seungwonbased/TIL/blob/main/AWS/assets/as3.png)

- 계정 내 사용자, 즉 IAM 사용자가 있는 경우 해당 사용자가 Amazon S3에 액세스하고자 함
- 정책을 통해 이 사용자에게 IAM 권한을 할당할 수 있음
- 정책이 S3 버킷으로의 액세스를 허용하므로 해당 사용자는 S3 버킷에 액세스할 수 있음

#### Example: EC2 Instances Access - Use IAM Roles

![as4](https://github.com/seungwonbased/TIL/blob/main/AWS/assets/as4.png)

- EC2 인스턴스가 있는 경우, EC2 인스턴스에서 S3 버킷으로 액세스를 제공할 수 있음
- IAM 역할을 사용해야 함
- 올바른 IAM 권한을 통해 EC2 인스턴스 역할을 생성
- 그러면 IAM 역할에 해당되는 EC2 인스턴스는 Amazon S3 버킷에 액세스할 수 있음

#### Advanced: Cross-Account Access – Use Bucket Policy

![as5](https://github.com/seungwonbased/TIL/blob/main/AWS/assets/as5.png)

- 교차 계정 액세스를 허용하려면 버킷 정책을 사용해야 함
- 다른 계정에 IAM 사용자가 있습니다

추가 버킷 정책을 생성해서 이 특정 IAM 사용자에게 교차 계정 액세스를 허용하려고 합니다

따라서 IAM 사용자는 S3 버킷으로 API 호출을 할 수 있게 되죠

여러분이 알아야 하는 다른 보안 설정이 있습니다, 바로 블록 공개 액세스에 관한

버킷 설정인데요

이것은 버킷을 생성할 때 우리가 설정한 겁니다

이 설정은 기업 데이터 유출을 방지하기 위한 추가 보안 계층으로서 AWS가 개발했죠

S3 버킷 정책을 설정하여 공개로 만들더라도 이 설정이 활성화되어 있다면

버킷은 결코 공개되지 않을 겁니다

이렇게 데이터 유출을 방지할 수 있는 거죠

버킷을 공개하면 안 되는 경우, 이 설정을 그대로 두면

잘못된 S3 버킷 정책을 설정한 사람들에 대해 이러한 수준의 보안을 갖출 수 있습니다

3S 버킷 중 어느 것도 공개되서는 안 된다면 계정 수준에서 이를 설정하면

됩니다

지금까지 S3 보안에 대해 알아봤습니다

이제 실습으로 넘어가보죠