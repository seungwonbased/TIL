# Elastic Beanstalk
## Typical Architecture: Web App 3-Tier

![bst](https://github.com/seungwonbased/TIL/blob/main/AWS/assets/bst1.png)

- 사용자로부터 모든 요청을 접수하는 로드 밸런서가 있고 다수의 가용 영역을 가진 오토 스케일링 그룹이 있으며 각각의 AZ에서 실행되는 EC2 인스턴스가 있음
- 그리고 백엔드에는 RDS 데이터베이스를 위한 데이터 서브넷이 있어 읽기와 쓰기를 받아들임
- 그 외 읽기 전용 복제본도 있음
- 캐싱 계층이 필요하다면 일래스티 캐시를 사용해야 함
- 배포할 수 많은 애플리케이션이 존재하고 이 중 대다수는 동일한, 비슷한 아키텍처를 따름
	- 이를 매번 다시 생성하는 건 힘든 일
	- 개발자로서 인프라를 관리하고 코드를 배포하는 것은 복잡
	- 모든 데이터와 로드 밸런서 등을 구성하고 싶지는 않음
	- 물론 모든 것이 확장 가능해야 함
- 보다시피 대부분의 웹 애플리케이션은 로드 밸런서와 오토 스케일링 그룹이 있는 동일한 아키텍처를 가짐
	- 개발자로서 원하는 것은 코드가 잘 실행되는 것뿐
	- 다른 것들에 대해서는 걱정하고 싶지 않음
	- 또한 여러 프로그래밍 언어로 개발할 때 여러 다른 애플리케이션과 환경이 있다면 아마도 애플리케이션을 배포하는 단 하나의 방법만을 원할 것임
- 이때 필요한 것이 Beanstalk

## Elastic Beanstalk - Overview

- Beanstalk은 AWS에서 애플리케이션을 배포하는 개발자 중심의 관점
- 즉 단 하나의 인터페이스로 지금까지 봤었던 EC2, ASG, ELB, RDS 등의 모든 구성 요소를 재사용하는 것
	- 이 모든 것을 배포하는 관리 서비스가 될 것임
	- 즉 용량 프로비저닝과 로드 밸런서의 구성, 확장, 애플리케이션 상태 모니터링, 인스턴스 구성 등을 처리해 줄 것임
	- 개발자가 신경써야 할 유일한 부분은 코드 그 자체 뿐
- 여전히 각각의 구성 요소를 완전히 제어할 수 있지만 Beanstalk에서는 하나의 인터페이스로 통합되어 있음
- 또한 Beanstalk는 아주 멋진 애플리케이션 업데이트 방법을 가지고 있음
- Beanstalk 서비스 자체는 무료지만 Beanstalk가 활용할 기본 인스턴스들이나 ASG 또는 ELB 등에 대한 비용은 지불해야 함

## Elastic Beanstalk - Components, Processes

![bst](https://github.com/seungwonbased/TIL/blob/main/AWS/assets/bst2.png)

- Beanstalk의 구성 요소는 애플리케이션으로 이루어져 있음
	- 이는 환경과 버전 그리고 구성을 가진 Beanstalk 구성 요소들의 묶음으로 구성되어 있음
- 애플리케이션 버전
	- 애플리케이션 코드의 반복
	- 그래서 버전 1, 버전 2 버전 3 등이 있을 수 있음
- 환경
	- 특정 애플리케이션 버전을 실행하는 리소스의 모음
	- 환경 내에서는 한 번에 하나의 애플리케이션 버전만 존재할 수 있음
	- 환경 내에서 애플리케이션 버전을 버전 1에서 버전 2로 업데이트 할 수 있음
	- 티어
		- 웹 서버 환경 티어
		- 작업자 환경 티어
	- dev, test, prod 등 어떤 환경이든 다수의 환경을 만들 수 있음
- 프로세스
	- 애플리케이션 생성
	- 버전 업로드
	- 환경 실행
	- 환경 수명 주기 관리
	- 이를 반복하고 싶다면 새로운 버전을 업로드하여 버전을 업데이트하고 환경 내에서 새로운 버전을 다시 실행하여 애플리케이션 스택을 업데이트
- Beanstalk은 여러 프로그래밍 언어를 지원
	- Go, Java SE, Java with Tomcat .NET Core on Linux, .NET Core on Windows Server, Node.js, PHP, Python, Ruby, Packer Builder, Single Container Docker, Multi-container Docker, Preconfigured Docker 등
	- 원하는 프로그래밍 언어가 여기에 없다면 사용자 지정 플랫폼을 만들 수 있는 고급 기능도 있음
	- Beanstalk에서는 거의 모든 것을 배포할 수 있다고 보면 됨

## Web Server Tier vs Worker Tier

![bst](https://github.com/seungwonbased/TIL/blob/main/AWS/assets/bst3.png)

- 웹 티어
	- 알고있는 전통적인 방식의 아키텍처
	- 로드 밸런서가 있는데, 여기에서 웹 서버가 될 다수의 EC2 인스턴스가 있는 오토 스케일링 그룹으로 트래픽을 보냄
- 작업자 티어
	- 따라서 이번에는 클라이언트가 직접 EC2 인스턴스에 접근하지 않음
	- 메시지 대기열인 SQS 대기열을 사용할 것임
	- 메시지가 SQS 대기열로 전송됨
	- 그리고 EC2 인스턴스들이 작업자가 됨
		- 왜냐하면 SQS 대기열로부터 메시지를 가져와서 처리하기 때문
	- 그리고 이 경우에는 작업자 환경이 SQS 메시지 숫자에 따라 확장될 것임
		- 즉 메시지가 많을수록 EC2 인스턴스도 많아짐
	- 멋진 점은 웹 환경이 작업자 환경의 SQS 대기열로 메시지를 푸시함으로써 웹 환경과 작업자 환경이 함께 할 수 있다는 점

